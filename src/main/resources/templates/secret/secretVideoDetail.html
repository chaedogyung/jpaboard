<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <title th:text="${video.title}">동영상 상세</title>
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">

    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <!-- Video.js 핵심 -->
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

    <style>
        .video-container {
            width: 1280px;
            height: 720px;
            margin: auto;
        }
        .video-js {
            width: 100% !important;
            height: 100% !important;
            outline: none; /* 포커스 테두리 제거 */
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const player = videojs('my-video', {
                controls: true,
                autoplay: true,
                fluid: false,
                width: 1280,
                height: 720,
                playbackRates: [0.5, 1, 1.5, 2],
                userActions: { hotkeys: true },
                html5: { nativeTextTracks: false }
            });

            // 마우스 올리면 자동 포커스
            const videoEl = document.getElementById('my-video');
            videoEl.setAttribute('tabindex', '0'); // 키보드 포커스 가능하도록
            videoEl.addEventListener('mouseenter', () => {
                videoEl.focus();
            });

            // 방향키로 탐색 가능하도록 직접 핸들러 추가
            videoEl.addEventListener('keydown', (event) => {
                if (event.key === 'ArrowLeft') {
                    player.currentTime(player.currentTime() - 5);
                    event.preventDefault();
                } else if (event.key === 'ArrowRight') {
                    player.currentTime(player.currentTime() + 5);
                    event.preventDefault();
                }
            });

            // 자막 자동 표시
            player.ready(function() {
                const tracks = player.textTracks();
                for (let i = 0; i < tracks.length; i++) {
                    if (tracks[i].kind === 'subtitles' && tracks[i].language === 'ko') {
                        tracks[i].mode = 'showing';
                    }
                }
            });
        });
    </script>
</head>
<body>
<div layout:fragment="content">
    <!-- 비디오 플레이어 -->
    <div class="video-container">
        <video id="my-video"
               class="video-js vjs-big-play-centered"
               controls
               preload="auto">
            <source th:src="@{/secretVideoUploads/{encodeUrl}(encodeUrl=${encodeUrl})}" type="video/mp4">
            <track th:src="@{/secretVideoUploads/{subtitlePath}(subtitlePath=${subtitlePath})}"
                   kind="subtitles"
                   srclang="ko"
                   label="한국어"
                   default>
            <p class="vjs-no-js">
                이 비디오를 시청하려면 JavaScript를 활성화하고 HTML5 비디오를 지원하는 브라우저가 필요합니다.
            </p>
        </video>
    </div>

    <!-- 동영상 정보 -->
    <div class="video-info">
        <div class="video-title" th:text="${video.title}"></div>
        <div class="video-meta">
            장르: <span th:text="${video.genre}"></span><br>
            출시일: <span th:text="${video.release_date}"></span><br>
            연령 등급: <span th:text="${video.age_rating}"></span><br>
            언어: <span th:text="${video.language}"></span>
        </div>
        <div class="video-description" th:text="${video.description}"></div>
    </div>
</div>
</body>
</html>
